<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/main.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * &lt;insert one-line description of what the program does>
 * Copyright (c) 2014, Intel Corporation.
 *
 * This program is free software; you can redistribute it and/or modify it
 * under the terms and conditions of the GNU Lesser General Public License,
 * version 2.1, as published by the Free Software Foundation.
 *
 * This program is distributed in the hope it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU Lesser General Public License for
 * more details.
 *
 * Created by adua.
 */
'use strict';
var dns = require('dns');

var ConfigManager = require("./core/config-manager.js");
ConfigManager.init(__dirname, "config.json");

exports.config = ConfigManager.config;
exports.ServiceSpecValidator = require("./core/ServiceSpecValidator.js");
exports.ServiceQuery = require("./core/ServiceQuery.js");

exports.sayhello = function ()
{
	return "Hello Edison user!";
};

var Service = require("./core/Service.js");
var Client = require("./core/Client.js");
var EdisonMDNS = require("./core/EdisonMDNS.js"); // singleton use as is

function createServiceWithNumericAddress(serviceSpec, serviceCreatedCallback) {
  var service = new Service(serviceSpec);
  if (!service.spec.advertise || service.spec.advertise.locally) {
    EdisonMDNS.advertiseService(service.spec);
  }
  serviceCreatedCallback(service);
}

exports.createService = function (serviceSpec, serviceCreatedCallback) {
  if (serviceSpec.address) {
    dns.lookup(serviceSpec.address, 4, function (err, address, family) {
      if (err) {
        console.log(err);
        throw err;
      }

      if (family != 4) {
        console.log("WARN: Got IPv6 address even when IPv4 was requested. Waiting for an IPv4 address...");
        return;
      }

      serviceSpec.address = address;
      createServiceWithNumericAddress(serviceSpec, serviceCreatedCallback);
    });
  } else {
    createServiceWithNumericAddress(serviceSpec, serviceCreatedCallback);
  }
};

exports.createClient = function (serviceQuery, serviceFilter, clientCreatedCallback) {
  EdisonMDNS.discoverServices(serviceQuery, serviceFilter, function(serviceSpec) {
    clientCreatedCallback(new Client(serviceSpec));
  });
};

exports.discoverServices = function (serviceQuery, serviceFoundCallback) {
  EdisonMDNS.discoverServices(serviceQuery, null, serviceFoundCallback);
};

exports.createClientForGivenService = function (serviceSpec, clientCreatedCallback) {
  clientCreatedCallback(new Client(serviceSpec));
};

exports.advertiseService = function(serviceSpec) {
  if (serviceSpec.address) {
    dns.lookup(serviceSpec.address, 4, function (err, address, family) {
      if (err) {
        console.log(err);
        throw err;
      }

      if (family != 4) {
        console.log("WARN: Got IPv6 address even when IPv4 was requested. Waiting for an IPv4 address...");
        return;
      }

      serviceSpec.address = address;
      if (!serviceSpec.advertise || serviceSpec.advertise.locally) {
        EdisonMDNS.advertiseService(serviceSpec);
      }
    });
  } else {
    if (!serviceSpec.advertise || serviceSpec.advertise.locally) {
      EdisonMDNS.advertiseService(serviceSpec);
    }
  }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-config-manager.html">config-manager</a></li><li><a href="module-EdisonMDNS.html">EdisonMDNS</a></li><li><a href="module-plugin-manager.html">plugin-manager</a></li><li><a href="module-ServiceQuery.html">ServiceQuery</a></li><li><a href="module-ServiceRecord.html">ServiceRecord</a></li></ul><h3>Classes</h3><ul><li><a href="Client.html">Client</a></li><li><a href="EdisonIoTKitClient.html">EdisonIoTKitClient</a></li><li><a href="EdisonMQTTClient.html">EdisonMQTTClient</a></li><li><a href="EdisonMQTTService.html">EdisonMQTTService</a></li><li><a href="module-EdisonMDNS-EdisonMDNS.html">EdisonMDNS</a></li><li><a href="module-ServiceQuery-ServiceQuery.html">ServiceQuery</a></li><li><a href="module-ServiceRecord-ServiceRecord.html">ServiceRecord</a></li><li><a href="Service.html">Service</a></li><li><a href="ServiceSpecValidator.html">ServiceSpecValidator</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-service-query.html">Service Query</a></li><li><a href="tutorial-service-record.html">Service Record</a></li><li><a href="tutorial-service-spec.html">Service Specification</a></li></ul><h3>Global</h3><ul><li><a href="global.html#edison">edison</a></li><li><a href="global.html#edisonLib">edisonLib</a></li><li><a href="global.html#expect">expect</a></li><li><a href="global.html#path">path</a></li><li><a href="global.html#run">run</a></li><li><a href="global.html#util">util</a></li><li><a href="global.html#zeromq">zeromq</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha5</a> on Wed May 21 2014 17:14:26 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
